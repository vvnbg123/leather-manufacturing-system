<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leather Manufacturing System</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const LeatherProductionSystem = () => {
          // Worker data with hourly rates
          const workers = {
            '–ì–ú1': { name: '–ì–µ–æ—Ä–≥–∏ –ú–∏—Ö–∞–π–ª–æ–≤', hourlyRate: 15.50, available: true },
            '–ì–ú3': { name: '–ú–∞—Ä–∏—è –ì–µ–æ—Ä–≥–∏–µ–≤–∞', hourlyRate: 14.20, available: true },
            '–ì–ú4': { name: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤', hourlyRate: 16.00, available: true },
            '–ù–î1': { name: '–ù–∞–¥–µ–∂–¥–∞ –î–∏–º–∏—Ç—Ä–æ–≤–∞', hourlyRate: 13.80, available: false },
            '–ï–ú1': { name: '–ï–ª–µ–Ω–∞ –ú–∞—Ä–∏–Ω–æ–≤–∞', hourlyRate: 15.00, available: true },
            '–ú–ú1': { name: '–ú–∏–ª–µ–Ω –ú–∏–ª–µ–Ω–æ–≤', hourlyRate: 17.20, available: true },
            '–ò–°1': { name: '–ò–≤–µ–ª–∏–Ω –°—Ç–æ—è–Ω–æ–≤', hourlyRate: 12.90, available: true },
            '–•–•–•': { name: 'Temp Worker', hourlyRate: 14.50, available: true },
            '–¢–ì1': { name: '–¢–æ–¥–æ—Ä –ì–µ–æ—Ä–≥–∏–µ–≤', hourlyRate: 18.00, available: true },
            '–ò–ì1': { name: '–ò—Ä–∏–Ω–∞ –ì–µ–æ—Ä–≥–∏–µ–≤–∞', hourlyRate: 13.50, available: true }
          };

          // System state
          const [currentUser, setCurrentUser] = useState(null);
          const [userRole, setUserRole] = useState(null);
          const [workCards, setWorkCards] = useState([]);
          const [officeActiveTab, setOfficeActiveTab] = useState('schedule');
          const [modelDatabase, setModelDatabase] = useState([]);

          // Initialize with sample data
          useEffect(() => {
            if (workCards.length === 0) {
              const sampleCards = [
                {
                  id: 'WC-001',
                  productName: '–ù–∞—à–∏–π–Ω–∏–∫ "–ö–µ–Ω–¥–∏"',
                  model: 'CY3MGDGD2',
                  size: 'M',
                  quantity: 20,
                  priority: 1,
                  status: '–í –ø—Ä–æ—Ü–µ—Å',
                  createdDate: new Date().toISOString(),
                  dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                  images: [],
                  operationGroups: [
                    {
                      id: 'group-1',
                      name: '–∫—Ä–æ–µ–Ω–µ',
                      assignedWorker: '–ì–ú1',
                      operations: [
                        { name: '–æ—Å–Ω–æ–≤–∞ - —á–µ—Ä–µ–Ω –±–ª–∞–Ω–∫', timeSeconds: 10800 },
                        { name: '—à–ø–∞–ª—Ç', timeSeconds: 3600 }
                      ],
                      completed: false,
                      completedDate: null,
                      images: []
                    },
                    {
                      id: 'group-2', 
                      name: '–ø–µ—á–∞—Ç',
                      assignedWorker: '–ï–ú1',
                      operations: [
                        { name: '–ø–µ—á–∞—Ç —Å —Ä–∞–∑–º–µ—Ä', timeSeconds: 5400 },
                        { name: '–ø–æ—á–∏—Å—Ç–≤–∞–Ω–µ', timeSeconds: 4200 }
                      ],
                      completed: false,
                      completedDate: null,
                      images: []
                    }
                  ]
                }
              ];
              setWorkCards(sampleCards);
            }

            if (modelDatabase.length === 0) {
              const sampleModels = [
                {
                  id: 'CY3MGDGD2',
                  productName: '–ù–∞—à–∏–π–Ω–∏–∫ "–ö–µ–Ω–¥–∏"',
                  category: '–ù–∞—à–∏–π–Ω–∏—Ü–∏',
                  sizes: ['S', 'M', 'L', 'XL'],
                  defaultOperations: [
                    { name: '–ª–∏—Ü–µ - –±—è–ª –±–ª–∞–Ω–∫', timeSeconds: 10800, group: '–∫—Ä–æ–µ–Ω–µ' },
                    { name: '–ø–µ—á–∞—Ç —Å —Ä–∞–∑–º–µ—Ä', timeSeconds: 5400, group: '–ø–µ—á–∞—Ç' }
                  ]
                }
              ];
              setModelDatabase(sampleModels);
            }
          }, []);

          // Utility functions
          const formatTime = (seconds) => {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            return hours > 0 ? `${hours}h ${minutes}m` : `${minutes}m`;
          };

          const formatCurrency = (amount) => {
            return `${amount.toFixed(2)} –ª–≤.`;
          };

          const formatDate = (dateString) => {
            return new Date(dateString).toLocaleDateString('bg-BG');
          };

          const calculateGroupTime = (group, quantity = 1) => {
            return group.operations.reduce((total, op) => total + (op.timeSeconds * quantity), 0);
          };

          const calculateGroupWage = (group, quantity = 1) => {
            const timeHours = calculateGroupTime(group, quantity) / 3600;
            const worker = workers[group.assignedWorker];
            return worker ? timeHours * worker.hourlyRate : 0;
          };

          // Login system
          const handleLogin = (userId, role) => {
            setCurrentUser(userId);
            setUserRole(role);
          };

          const handleLogout = () => {
            setCurrentUser(null);
            setUserRole(null);
          };

          // Worker functions
          const getWorkerAssignedTasks = (workerId) => {
            const tasks = [];
            workCards
              .sort((a, b) => a.priority - b.priority)
              .forEach(card => {
                card.operationGroups.forEach(group => {
                  if (group.assignedWorker === workerId && !group.completed) {
                    tasks.push({
                      cardId: card.id,
                      groupId: group.id,
                      cardName: `${card.productName} (${card.model})`,
                      groupName: group.name,
                      operations: group.operations,
                      totalTime: calculateGroupTime(group, card.quantity),
                      wage: calculateGroupWage(group, card.quantity),
                      priority: card.priority,
                      quantity: card.quantity
                    });
                  }
                });
              });
            return tasks.slice(0, 5);
          };

          const markGroupCompleted = (cardId, groupId) => {
            setWorkCards(prev => prev.map(card => {
              if (card.id === cardId) {
                return {
                  ...card,
                  operationGroups: card.operationGroups.map(group =>
                    group.id === groupId
                      ? { ...group, completed: true, completedDate: new Date().toISOString() }
                      : group
                  )
                };
              }
              return card;
            }));
          };

          // Login Screen
          if (!currentUser) {
            return (
              <div className="min-h-screen bg-gradient-to-br from-blue-600 to-blue-800 flex items-center justify-center p-4">
                <div className="bg-white rounded-lg shadow-xl p-8 w-full max-w-md">
                  <div className="text-center mb-8">
                    <h1 className="text-3xl font-bold text-gray-800 mb-2">–°–∏—Å—Ç–µ–º–∞ –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</h1>
                    <p className="text-gray-600">–ö–æ–∂–µ–Ω–∏ –∏–∑–¥–µ–ª–∏—è</p>
                  </div>

                  <div className="space-y-4">
                    <div>
                      <h2 className="text-lg font-semibold mb-3 text-gray-700">–û—Ñ–∏—Å –ø–µ—Ä—Å–æ–Ω–∞–ª</h2>
                      <button
                        onClick={() => handleLogin('office', 'office')}
                        className="w-full bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-lg flex items-center justify-center gap-2"
                      >
                        ‚öôÔ∏è –í—Ö–æ–¥ –∫–∞—Ç–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
                      </button>
                    </div>

                    <div>
                      <h2 className="text-lg font-semibold mb-3 text-gray-700">–†–∞–±–æ—Ç–Ω–∏—Ü–∏</h2>
                      <div className="grid grid-cols-2 gap-2">
                        {Object.entries(workers).map(([workerId, worker]) => (
                          <button
                            key={workerId}
                            onClick={() => handleLogin(workerId, 'worker')}
                            disabled={!worker.available}
                            className={`p-3 rounded-lg flex flex-col items-center gap-1 text-sm ${
                              worker.available
                                ? 'bg-green-100 hover:bg-green-200 text-green-800'
                                : 'bg-gray-100 text-gray-400 cursor-not-allowed'
                            }`}
                          >
                            üë§
                            <span className="font-medium">{workerId}</span>
                            <span className="text-xs text-center">{worker.name}</span>
                          </button>
                        ))}
                      </div>
                    </div>
                  </div>

                  <div className="mt-8 text-center text-sm text-gray-500">
                    <p>–ó–∞ —Ç–µ—Å—Ç–≤–∞–Ω–µ: –û—Ç–≤–æ—Ä–µ—Ç–µ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ç–∞–±–æ–≤–µ –∑–∞ —Å–∏–º—É–ª–∞—Ü–∏—è –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏</p>
                  </div>
                </div>
              </div>
            );
          }

          // Office Dashboard
          if (userRole === 'office') {
            return (
              <div className="min-h-screen bg-gray-50">
                <div className="bg-blue-600 text-white p-4 shadow-lg">
                  <div className="max-w-7xl mx-auto flex justify-between items-center">
                    <div>
                      <h1 className="text-2xl font-bold">–û—Ñ–∏—Å –ø–∞–Ω–µ–ª</h1>
                      <p className="text-blue-100">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Ä–∞–±–æ—Ç–Ω–∏ –∫–∞—Ä—Ç–∏</p>
                    </div>
                    <button
                      onClick={handleLogout}
                      className="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded flex items-center gap-2"
                    >
                      ‚Ü©Ô∏è –ò–∑—Ö–æ–¥
                    </button>
                  </div>
                </div>

                <div className="max-w-7xl mx-auto p-6">
                  <div className="mb-6 flex justify-between items-center">
                    <h2 className="text-2xl font-bold">–ì—Ä–∞—Ñ–∏–∫ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ—Ç–æ</h2>
                    <button className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center gap-2">
                      ‚ûï –ù–æ–≤–∞ —Ä–∞–±–æ—Ç–Ω–∞ –∫–∞—Ä—Ç–∞
                    </button>
                  </div>

                  <div className="space-y-4">
                    {workCards
                      .sort((a, b) => a.priority - b.priority)
                      .map((card) => (
                        <div
                          key={card.id}
                          className="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500"
                        >
                          <div className="flex justify-between items-start mb-4">
                            <div>
                              <div className="flex items-center gap-3 mb-2">
                                <div className="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
                                  –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç {card.priority}
                                </div>
                                <h3 className="text-xl font-bold text-gray-800">{card.productName}</h3>
                              </div>
                              <p className="text-gray-600">{card.model} ({card.size}) ‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: {card.quantity}</p>
                              <div className="flex items-center gap-4 mt-1">
                                <p className="text-sm text-gray-500">–ö—Ä–∞–µ–Ω —Å—Ä–æ–∫: {formatDate(card.dueDate)}</p>
                                <div className="flex items-center gap-1">
                                  <div className="w-2 h-2 rounded-full bg-yellow-500"></div>
                                  <span className="text-xs text-gray-600">–í –ø—Ä–æ—Ü–µ—Å</span>
                                </div>
                              </div>
                            </div>
                          </div>

                          <div className="space-y-3">
                            {card.operationGroups.map((group) => (
                              <div
                                key={group.id}
                                className={`p-4 rounded-lg border ${
                                  group.completed ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'
                                }`}
                              >
                                <div className="flex justify-between items-center mb-2">
                                  <div className="flex items-center gap-3">
                                    <h4 className="font-semibold text-gray-800">{group.name.toUpperCase()}</h4>
                                    {group.completed && <span className="text-green-600">‚úÖ</span>}
                                  </div>
                                  <div className="flex items-center gap-2">
                                    <select
                                      value={group.assignedWorker}
                                      onChange={(e) => {
                                        const newWorkerId = e.target.value;
                                        setWorkCards(prev => prev.map(c => 
                                          c.id === card.id 
                                            ? {
                                                ...c,
                                                operationGroups: c.operationGroups.map(g =>
                                                  g.id === group.id ? { ...g, assignedWorker: newWorkerId, completed: false } : g
                                                )
                                              }
                                            : c
                                        ));
                                      }}
                                      className="border border-gray-300 rounded p-1 text-sm"
                                      disabled={group.completed}
                                    >
                                      <option value="">–ò–∑–±–µ—Ä–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫</option>
                                      {Object.entries(workers)
                                        .filter(([_, worker]) => worker.available)
                                        .map(([workerId, worker]) => (
                                          <option key={workerId} value={workerId}>
                                            {workerId} - {worker.name}
                                          </option>
                                        ))}
                                    </select>
                                    <button
                                      onClick={() => {
                                        setWorkCards(prev => prev.map(c => 
                                          c.id === card.id 
                                            ? {
                                                ...c,
                                                operationGroups: c.operationGroups.map(g =>
                                                  g.id === group.id ? { ...g, completed: !g.completed, completedDate: !g.completed ? new Date().toISOString() : null } : g
                                                )
                                              }
                                            : c
                                        ));
                                      }}
                                      className={`p-1 rounded text-sm ${
                                        group.completed 
                                          ? 'bg-yellow-200 hover:bg-yellow-300 text-yellow-800' 
                                          : 'bg-green-200 hover:bg-green-300 text-green-800'
                                      }`}
                                    >
                                      {group.completed ? '–û—Ç–º–µ–Ω–∏' : '–ó–∞–≤—ä—Ä—à–∏'}
                                    </button>
                                  </div>
                                </div>

                                <div className="text-sm text-gray-600 mb-2">
                                  –í—Ä–µ–º–µ: {formatTime(calculateGroupTime(group, card.quantity))} ‚Ä¢ 
                                  –ó–∞–ø–ª–∞—Ç–∞: {formatCurrency(calculateGroupWage(group, card.quantity))}
                                </div>

                                <div className="text-xs text-gray-500">
                                  –û–ø–µ—Ä–∞—Ü–∏–∏: {group.operations.map(op => op.name).join(', ')}
                                </div>
                              </div>
                            ))}
                          </div>
                        </div>
                      ))}
                  </div>
                </div>
              </div>
            );
          }

          // Worker Interface
          if (userRole === 'worker') {
            const workerTasks = getWorkerAssignedTasks(currentUser);
            const worker = workers[currentUser];

            return (
              <div className="min-h-screen bg-gray-50">
                <div className="bg-green-600 text-white p-4 shadow-lg">
                  <div className="max-w-4xl mx-auto flex justify-between items-center">
                    <div>
                      <h1 className="text-2xl font-bold">–ó–¥—Ä–∞–≤–µ–π, {worker.name}</h1>
                      <p className="text-green-100">–¢–≤–æ–∏—Ç–µ –∑–∞–¥–∞—á–∏ ({currentUser})</p>
                    </div>
                    <button
                      onClick={handleLogout}
                      className="bg-green-500 hover:bg-green-600 px-4 py-2 rounded flex items-center gap-2"
                    >
                      ‚Ü©Ô∏è –ò–∑—Ö–æ–¥
                    </button>
                  </div>
                </div>

                <div className="max-w-4xl mx-auto p-6">
                  {workerTasks.length === 0 ? (
                    <div className="text-center py-12">
                      <div className="text-green-500 mb-4 text-6xl">‚úÖ</div>
                      <h2 className="text-2xl font-bold text-gray-800 mb-2">–ù—è–º–∞ –∞–∫—Ç–∏–≤–Ω–∏ –∑–∞–¥–∞—á–∏</h2>
                      <p className="text-gray-600">–í—Å–∏—á–∫–∏ —Ç–≤–æ–∏ –∑–∞–¥–∞—á–∏ —Å–∞ –∑–∞–≤—ä—Ä—à–µ–Ω–∏!</p>
                    </div>
                  ) : (
                    <div className="space-y-6">
                      <div className="bg-blue-50 p-4 rounded-lg">
                        <h2 className="font-bold text-blue-800 mb-2">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∏ –∑–∞–¥–∞—á–∏</h2>
                        <p className="text-blue-600 text-sm">–ü–æ–∫–∞–∑–∞–Ω–∏ —Å–∞ —Å–∞–º–æ –Ω–∞–π-–≤–∞–∂–Ω–∏—Ç–µ –∑–∞–¥–∞—á–∏. –ó–∞–≤—ä—Ä—à–∏ –≥–∏ –ø–æ —Ä–µ–¥.</p>
                      </div>

                      {workerTasks.map((task) => (
                        <div key={`${task.cardId}-${task.groupId}`} className="bg-white rounded-lg shadow-md p-6 border-l-4 border-green-500">
                          <div className="mb-4">
                            <div className="flex items-center gap-3 mb-2">
                              <div className="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">
                                –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç {task.priority}
                              </div>
                              <h3 className="text-xl font-bold text-gray-800">{task.cardName}</h3>
                            </div>
                            <h4 className="text-lg font-semibold text-green-700 mb-2">{task.groupName.toUpperCase()}</h4>
                            <div className="text-gray-600">
                              <div>–í—Ä–µ–º–µ –∑–∞ —Ä–∞–±–æ—Ç–∞: <span className="font-medium">{formatTime(task.totalTime)}</span></div>
                              <div>–ó–∞–ø–ª–∞—Ç–∞: <span className="font-medium text-green-600">{formatCurrency(task.wage)}</span></div>
                            </div>
                          </div>

                          <div className="mb-4">
                            <h5 className="font-medium text-gray-700 mb-2">–û–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ:</h5>
                            <div className="space-y-1">
                              {task.operations.map((operation, index) => (
                                <div key={index} className="flex justify-between items-center text-sm">
                                  <span>{operation.name}</span>
                                  <span className="text-gray-500">{formatTime(operation.timeSeconds)}</span>
                                </div>
                              ))}
                            </div>
                          </div>

                          <button
                            onClick={() => markGroupCompleted(task.cardId, task.groupId)}
                            className="w-full bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-medium flex items-center justify-center gap-2"
                          >
                            ‚úÖ –ó–∞–≤—ä—Ä—à–∏ –∑–∞–¥–∞—á–∞—Ç–∞
                          </button>
                        </div>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            );
          }

          return null;
        };

        // Use createRoot instead of ReactDOM.render for React 18
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(LeatherProductionSystem));
    </script>
</body>
</html>
